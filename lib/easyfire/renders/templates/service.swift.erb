/**********************************************************
 * <%=@name%>ServiceEM.java
 * Firebase Services
 * Version: <%=@version%>
 * Generated by Easyfire. Do not modify this code 
 **********************************************************/
 
import android.net.Uri;
import android.support.annotation.NonNull;
import android.util.Log;


public class <%=@name%>ServiceEM {

    private final FirebaseDatabase database;
    private final DatabaseReference ref;
  
    private ValueEventListener buscaQuantidadeParticipantesHandle;
    private ValueEventListener buscaStatusMeuConviteHandler;

    public <%=@name%>ServiceEM(){
        this.database = FirebaseDatabase.getInstance();
        this.ref = database.getReference(<%=@collection_name%>)
    }

    <% if parent %>
      public void findBy(final String parentKey, final String key, final EasyfireDelegate delegate){
         this.ref.child(parentKey).child(key).addListenerForSingleValueEvent(new ValueEventListener() {
    <% else %>
      public void findBy(final String key,  final EasyfireDelegate delegate){
         this.ref.child(key).addListenerForSingleValueEvent(new ValueEventListener() {
    <%end%>
        @Override
        public void onDataChange(DataSnapshot dataSnapshot) {
            if(dataSnapshot.exists()){
                <%=@name%> <%=@name.uncapitalize%> = dataSnapshot.getValue(<%=@name%>.class);
                <%=@name.uncapitalize%>.key = dataSnapshot.getKey();
                delegate.changed(<%=@name.uncapitalize%>);
            }else{
                delegate.changed(null);
            }
        }
        @Override
        public void onCancelled(DatabaseError databaseError) {
            delegate.error(databaseError);
        }
      });
    }
    
    

    public void store(final <%=@name%> <%=@name.uncapitalize%>, 
                      final EasyfireDelegate delegate) {
                        
        final DatabaseReference localRef;
        
        if(<%=@name.uncapitalize%>.key == null){
            localRef = <%=@name.uncapitalize%>.isChild() ? 
                       ref.child(<%=@name.uncapitalize%>.getParentKey()).push() : 
                       ref.push()
                       
        }else{
            localRef = <%=@name.uncapitalize%>.isChild() ? 
                       ref.child(<%=@name.uncapitalize%>.getParentKey()).child(<%=@name.uncapitalize%>.getKey()) :
                       ref(<%=@name.uncapitalize%>.getKey())
                      
        }
        
        

        Task<Void> task = localRef.setValue(<%=@name.uncapitalize%>);
        task.addOnCompleteListener(new OnCompleteListener<Void>() {
            @Override
            public void onComplete(@NonNull Task<Void> task) {
                delegate.changed(true);
            }
        }).addOnFailureListener(new OnFailureListener() {
            @Override
            public void onFailure(@NonNull Exception e) {
                delegate.error(e);
            }
        });
    }

    public void delete(final <%=@name%> <%=@name.uncapitalize%>, final EasyfireDelegate delegate) {
        
        
        ref.child(camera.uid).child(camera.key).removeValue();
        delegate.changed();
    }

}